<view class="container">
  <view class="header">
    <view class="welcome-text">ä»Šå¤©æƒ³åƒç‚¹ä»€ä¹ˆï¼ŸğŸ˜‹</view>
    <image 
      class="header-avatar" 
      src="{{userInfo.avatarUrl || 'https://mmbiz.qpic.cn/mmbiz/icTdbqWNOwNRna42FI242Lcia07jQodd2FJGIYQfG0LAJGFxM4FbnQP6yfMxBgJ0F3YRqJCJ1aPAK2dQagdusBZg/0'}}" 
      mode="aspectFill"
      bindtap="toggleUserMenu"
    ></image>
  </view>

  <view class="main-content">
    
    <scroll-view class="sidebar" scroll-y>
      <view 
        wx:for="{{categoryList}}" 
        wx:key="id" 
        class="category-item {{currentCategory === index ? 'active' : ''}}"
        bindtap="switchCategory"
        data-index="{{index}}"
      >
        <view class="category-name">{{item.name}}</view>
        <view class="cat-badge" wx:if="{{item.count > 0}}">{{item.count}}</view>
      </view>
    </scroll-view>

    <scroll-view 
      class="dish-list" 
      scroll-y 
      scroll-with-animation="{{true}}"
      scroll-into-view="{{toView}}"
      bindscroll="onRightScroll"
    >
      <view class="dish-list-content">
        
        <view 
          class="category-block" 
          wx:for="{{categoryList}}" 
          wx:key="id" 
          wx:for-item="category" 
          wx:for-index="catIndex"
          id="category-{{catIndex}}" 
        >
          <view class="category-sticky-header">
            {{category.name}}
          </view>
          
          <view 
            class="dish-item" 
            wx:for="{{category.dishes}}" 
            wx:key="id" 
            wx:for-item="dish"
          >
            <image class="dish-img" src="{{dish.image}}" mode="aspectFill"></image>
            
            <view class="dish-info">
              <view class="dish-name">{{dish.name}}</view>
              <view class="dish-desc">{{dish.description || 'ç¾å‘³å®¶å¸¸èœ'}}</view>
              
              <view class="dish-bottom">
                <view class="dish-price">{{dish.price}}</view>
                
                <view class="stepper">
                  <view 
                    class="btn minus" 
                    wx:if="{{cart[dish.id] > 0}}" 
                    catchtap="updateCart" 
                    data-type="minus" 
                    data-id="{{dish.id}}"
                    data-cat-index="{{catIndex}}"
                  >-</view>
                  
                  <view class="count" wx:if="{{cart[dish.id] > 0}}">{{cart[dish.id]}}</view>
                  
                  <view 
                    class="btn add" 
                    catchtap="updateCart" 
                    data-type="add" 
                    data-id="{{dish.id}}"
                    data-cat-index="{{catIndex}}"
                  >+</view>
                </view>
              </view>
            </view>
          </view> 
        </view> 

      </view>
    </scroll-view>
  </view>

  <view class="bottom-bar" wx:if="{{totalCount > 0}}">
    <view class="cart-icon-wrapper">
      <view class="cart-icon">ğŸ›’</view>
      <view class="badge">{{totalCount}}</view>
    </view>
    <view class="total-price">
      <text class="currency">Â¥</text>
      <text class="amount">{{totalPrice}}</text>
    </view>
    <button class="submit-btn" bindtap="goToOrder">é€‰å¥½äº†</button>
  </view>

  <view class="menu-mask" wx:if="{{showUserMenu}}" bindtap="toggleUserMenu">
    <view class="menu-popup" catchtap="preventBubble"> 
      <view class="menu-header">
        <image class="menu-avatar" src="{{userInfo.avatarUrl || 'https://mmbiz.qpic.cn/mmbiz/icTdbqWNOwNRna42FI242Lcia07jQodd2FJGIYQfG0LAJGFxM4FbnQP6yfMxBgJ0F3YRqJCJ1aPAK2dQagdusBZg/0'}}"></image>
        <view class="menu-nickname">{{userInfo.nickName || 'æœªç™»å½•'}}</view>
      </view>
      
      <view class="menu-grid">
        <view class="menu-item" bindtap="handleMenuAction" data-type="address">
          <view class="menu-icon" style="background: #e1f5fe; color: #0288d1;">ğŸ“</view>
          <text>ä¿®æ”¹ä¿¡æ¯</text>
        </view>
        <view class="menu-item" bindtap="handleMenuAction" data-type="feedback">
          <view class="menu-icon" style="background: #e8f5e9; color: #388e3c;">ğŸ’¬</view>
          <text>èœå“åé¦ˆ</text>
        </view>
        <view class="menu-item" bindtap="handleMenuAction" data-type="donate">
          <view class="menu-icon" style="background: #fce4ec; color: #c2185b;">ğŸ§§</view>
          <text>æ‰“èµå¤§å¨</text>
        </view>
        <view class="menu-item" bindtap="handleMenuAction" data-type="order">
          <view class="menu-icon" style="background: #fff3e0; color: #f57c00;">ğŸ“„</view>
          <text>è®¢å•ç®¡ç†</text>
        </view>
      </view>
    </view>
  </view>

</view>
<view class="bottom-bar" wx:if="{{totalCount > 0}}" style="z-index: 200;"> <view class="cart-icon-wrapper" bindtap="toggleCartDetail"> <view class="cart-icon">ğŸ›’</view> <view class="badge">{{totalCount}}</view> </view> <view class="total-price" bindtap="toggleCartDetail"> <text class="currency">Â¥</text> <text class="amount">{{totalPrice}}</text> </view>

<button class="submit-btn" bindtap="goToOrder">é€‰å¥½äº†</button>
</view>

<view class="cart-detail-mask" wx:if="{{showCartDetail}}" bindtap="toggleCartDetail"> <view class="cart-detail-popup" catchtap="preventBubble">
  <view class="cart-header">
  <text class="cart-title">å·²é€‰å•†å“</text>
  <view class="clear-cart" bindtap="clearCart">
    <text>ğŸ—‘ï¸ æ¸…ç©º</text>
  </view>
</view>

<scroll-view class="cart-scroll" scroll-y>
  <view class="cart-item" wx:for="{{cartList}}" wx:key="id">
    <view class="cart-item-name">{{item.name}}</view>
    <view class="cart-item-right">
      <text class="cart-item-price">Â¥{{item.price * item.count}}</text>
      
      <view class="stepper">
        <view class="btn minus" catchtap="updateCart" data-type="minus" data-id="{{item.id}}" data-cat-index="{{item.catIndex}}">-</view>
        <view class="count">{{item.count}}</view>
        <view class="btn add" catchtap="updateCart" data-type="add" data-id="{{item.id}}" data-cat-index="{{item.catIndex}}">+</view>
      </view>
    </view>
  </view>
</scroll-view>
</view> </view>